@page "/"
@using System.Security.Claims
@using InstagramClone.Core.DTOs
@using InstagramClone.Client.Resources

<PageTitle>Instagram</PageTitle>

<div class="min-h-screen flex items-center justify-center bg-instagram-gray-light dark:bg-instagram-gray-dark py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full">
        <AuthorizeView>
            <Authorized>
                @if (isLoading)
                {
                    <div class="text-center text-gray-600 dark:text-gray-400">@UI.Home_LoadingFeed</div>
                }
                else if (!string.IsNullOrEmpty(errorMessage))
                {
                    <div class="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 text-red-600 dark:text-red-200 px-4 py-3 rounded mb-4">
                        <p class="font-semibold">@errorMessage</p>
                        <button @onclick="ReloadFeed" class="mt-2 text-sm underline">Try again</button>
                    </div>
                }
                else if (feed != null && feed.Count == 0)
                {
                    <div class="text-center text-gray-600 dark:text-gray-400">
                        @UI.Home_NoPosts
                        <a class="instagram-link" href="/new-post">@UI.Home_CreateOne</a>
                    </div>
                }
                else if (feed != null)
                {
                    <div class="max-w-xl mx-auto space-y-6">
                        @foreach (var p in feed)
                        {
                            <div class="bg-instagram-bg-primary-light dark:bg-instagram-bg-primary-dark border border-instagram-border-light dark:border-instagram-border-dark rounded-sm">
                                <div class="px-4 py-3">
                                    <a href="/profile/@p.Username" class="font-semibold text-instagram-text-primary-light dark:text-instagram-text-primary-dark hover:text-gray-600 dark:hover:text-gray-400">@p.Username</a>
                                </div>
                                <img src="@p.ImageUrl" alt="post" class="w-full" />
                                @if (!string.IsNullOrWhiteSpace(p.Caption))
                                {
                                    <div class="px-4 py-3 text-sm text-instagram-text-primary-light dark:text-instagram-text-primary-dark">
                                        <a href="/profile/@p.Username" class="font-semibold hover:text-gray-600 dark:hover:text-gray-400">@p.Username</a> @p.Caption
                                    </div>
                                }
                                <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400">@p.CreatedAt.ToLocalTime().ToString("g")</div>
                            </div>
                        }
                    </div>
                }
            </Authorized>
            <NotAuthorized>
                <div class="text-center">
                    <h1 class="text-5xl font-bold mb-2 bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 bg-clip-text text-transparent">
                        @UI.Home_Welcome
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 mb-8 text-lg">@UI.Home_Tagline</p>
                    
                    <div class="bg-instagram-bg-primary-light dark:bg-instagram-bg-primary-dark rounded-lg shadow-md p-8 border border-instagram-border-light dark:border-instagram-border-dark mb-4">
                        <p class="text-gray-700 dark:text-gray-300 mb-6">
                            @UI.Home_JoinMessage
                        </p>
                        <a href="/register" class="block w-full py-2 px-4 bg-instagram-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors mb-3">
                            @UI.Common_Signup
                        </a>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            @UI.Home_AlreadyAccount <a href="/login" class="instagram-link">@UI.Common_Login</a>
                        </p>
                    </div>
                    
                    <div class="text-center text-sm text-gray-500 dark:text-gray-400">
                        <p>@UI.Home_BuiltWith</p>
                    </div>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</div>
