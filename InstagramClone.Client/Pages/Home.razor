@page "/"
@using System.Security.Claims
@using InstagramClone.Core.DTOs
@using InstagramClone.Client.Resources

<PageTitle>Instagram</PageTitle>

<div class="min-h-screen bg-instagram-gray-light dark:bg-instagram-gray-dark py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-screen-md mx-auto flex justify-center">
        <AuthorizeView>
            <Authorized>
                @if (isLoading)
                {
                    <div class="text-center text-gray-600 dark:text-gray-400 py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-instagram-blue mx-auto"></div>
                        <p class="mt-4">@UI.Home_LoadingFeed</p>
                    </div>
                }
                else if (!string.IsNullOrEmpty(errorMessage))
                {
                    <div class="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 text-red-600 dark:text-red-200 px-4 py-3 rounded mb-4 max-w-[470px] w-full">
                        <p class="font-semibold">@errorMessage</p>
                    </div>
                }
                else if (feed.Count == 0)
                {
                    <div class="text-center text-gray-600 dark:text-gray-400 py-8 max-w-[470px] w-full">
                        @UI.Home_NoPosts
                        <a class="instagram-link" href="/new-post">@UI.Home_CreateOne</a>
                    </div>
                }
                else
                {
                    <div class="w-full flex flex-col items-center">
                        @foreach (var post in feed)
                        {
                            <PostCard 
                                Post="@post"
                                OnLikeToggle="@(() => ToggleLike(post))"
                                OnCommentClick="@(() => OpenComments(post))"
                                OnImageClick="@(() => OpenComments(post))" />
                        }

                        <!-- Loading More Indicator -->
                        @if (isLoadingMore)
                        {
                            <div class="text-center text-gray-600 dark:text-gray-400 py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-instagram-blue mx-auto"></div>
                                <p class="mt-2 text-sm">Loading more...</p>
                            </div>
                        }
                        else if (!hasMore)
                        {
                            <div class="text-center text-gray-500 dark:text-gray-400 py-8 text-sm">
                                You've reached the end!
                            </div>
                        }
                    </div>
                }
            </Authorized>
            <NotAuthorized>
                <div class="text-center max-w-md mx-auto">
                    <h1 class="text-5xl font-bold mb-2 bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 bg-clip-text text-transparent">
                        @UI.Home_Welcome
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 mb-8 text-lg">@UI.Home_Tagline</p>
                    
                    <div class="bg-instagram-bg-primary-light dark:bg-instagram-bg-primary-dark rounded-lg shadow-md p-8 border border-instagram-border-light dark:border-instagram-border-dark mb-4">
                        <p class="text-gray-700 dark:text-gray-300 mb-6">
                            @UI.Home_JoinMessage
                        </p>
                        <a href="/register" class="block w-full py-2 px-4 bg-instagram-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors mb-3">
                            @UI.Common_Signup
                        </a>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            @UI.Home_AlreadyAccount <a href="/login" class="instagram-link">@UI.Common_Login</a>
                        </p>
                    </div>
                    
                    <div class="text-center text-sm text-gray-500 dark:text-gray-400">
                        <p>@UI.Home_BuiltWith</p>
                    </div>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</div>

<!-- Comments Modal -->
<CommentsModal 
    IsOpen="@isCommentsModalOpen"
    Post="@selectedPost"
    OnClose="@CloseComments"
    OnPostLikeToggle="@(() => ToggleLike(selectedPost!))" />
