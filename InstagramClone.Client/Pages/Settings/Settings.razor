@page "/settings"
@attribute [Authorize]

<PageTitle>@UI.Settings_Title</PageTitle>

<div class="min-h-screen bg-instagram-gray py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white border border-instagram-border rounded-sm">
            <!-- Settings Header -->
            <div class="border-b border-instagram-border">
                <div class="flex">
                    <div class="w-64 border-r border-instagram-border">
                        <div class="py-4">
                            <a href="#" class="block px-8 py-3 border-l-2 border-black font-semibold">
                                @UI.Settings_EditProfile
                            </a>
                            <a href="/forgot-password" class="block px-8 py-3 text-gray-600 hover:bg-instagram-gray hover:border-l-2 hover:border-gray-300">
                                @UI.Settings_ChangePassword
                            </a>
                        </div>
                    </div>
                    <div class="flex-1 p-8">
                        @if (IsLoading)
                        {
                            <div class="flex justify-center items-center h-64">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-instagram-blue"></div>
                            </div>
                        }
                        else
                        {
                            <h2 class="text-2xl font-light mb-8">@UI.Settings_EditProfile</h2>

                            @if (!string.IsNullOrEmpty(SuccessMessage))
                            {
                                <div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-4 text-sm">
                                    @SuccessMessage
                                </div>
                            }

                            @if (!string.IsNullOrEmpty(ErrorMessage))
                            {
                                <div class="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded mb-4 text-sm">
                                    @ErrorMessage
                                </div>
                            }

                            <EditForm Model="@UpdateRequestModel" OnValidSubmit="@HandleUpdateProfile">
                                <DataAnnotationsValidator />

                                <!-- Profile Picture -->
                                <div class="flex items-center mb-6">
                                    <div class="w-16 h-16 bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600 rounded-full flex items-center justify-center mr-4">
                                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center">
                                            <span class="text-2xl">ðŸ‘¤</span>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">@CurrentProfile?.Username</h3>
                                        <button type="button" class="text-instagram-blue text-sm font-semibold">
                                            @UI.Settings_ChangePhoto
                                        </button>
                                    </div>
                                </div>

                                <!-- Username -->
                                <div class="mb-4 flex items-start">
                                    <label class="w-32 pt-2 text-right mr-8 font-semibold text-sm">@UI.Common_Username</label>
                                    <div class="flex-1">
                                        <InputText 
                                            class="w-full px-3 py-2 text-sm border border-instagram-border rounded-sm bg-white focus:outline-none focus:border-gray-400" 
                                            @bind-Value="UpdateRequestModel.Username" />
                                        <ValidationMessage For="@(() => UpdateRequestModel.Username)" class="text-red-500 text-xs mt-1" />
                                        <p class="text-xs text-gray-500 mt-1">
                                            @UI.Settings_UsernameHint
                                        </p>
                                    </div>
                                </div>

                                <!-- Email -->
                                <div class="mb-6 flex items-start">
                                    <label class="w-32 pt-2 text-right mr-8 font-semibold text-sm">@UI.Common_Email</label>
                                    <div class="flex-1">
                                        <InputText 
                                            type="email"
                                            class="w-full px-3 py-2 text-sm border border-instagram-border rounded-sm bg-white focus:outline-none focus:border-gray-400" 
                                            @bind-Value="UpdateRequestModel.Email" />
                                        <ValidationMessage For="@(() => UpdateRequestModel.Email)" class="text-red-500 text-xs mt-1" />
                                        @if (CurrentProfile?.IsEmailVerified == false)
                                        {
                                            <p class="text-xs text-orange-600 mt-1">@UI.Common_EmailNotVerified</p>
                                        }
                                    </div>
                                </div>

                                <!-- Language -->
                                <div class="mb-6 flex items-start">
                                    <label class="w-32 pt-2 text-right mr-8 font-semibold text-sm">Language</label>
                                    <div class="flex-1">
                                        <select value="@CurrentLanguage" class="w-full px-3 py-2 text-sm border border-instagram-border rounded-sm bg-white focus:outline-none focus:border-gray-400" @onchange="OnLanguageChanged">
                                            <option value="en">English</option>
                                            <option value="fr">FranÃ§ais</option>
                                            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Changes apply immediately.</p>
                                    </div>
                                </div>

                                <!-- Theme -->
                                <div class="mb-6 flex items-start">
                                    <label class="w-32 pt-2 text-right mr-8 font-semibold text-sm">Theme</label>
                                    <div class="flex-1">
                                        <select value="@CurrentTheme" @onchange="OnThemeChanged" class="w-full px-3 py-2 text-sm border border-instagram-border rounded-sm bg-white focus:outline-none focus:border-gray-400">
                                            <option value="light">Light</option>
                                            <option value="dark">Dark</option>
                                            <option value="system">System</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Choose your preferred theme.</p>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="flex items-center">
                                    <div class="w-32 mr-8"></div>
                                    <div class="flex-1 space-x-2">
                                        <button 
                                            type="submit" 
                                            class="px-6 py-1.5 bg-instagram-blue text-white text-sm font-semibold rounded hover:bg-blue-600 transition-colors disabled:opacity-50"
                                            disabled="@IsSaving">
                                            @if (IsSaving)
                                            {
                                                <span>@UI.Common_Saving</span>
                                            }
                                            else
                                            {
                                                <span>@UI.Common_Submit</span>
                                            }
                                        </button>
                                        <a href="/profile" class="inline-block px-6 py-1.5 text-sm font-semibold hover:underline">
                                            @UI.Common_Cancel
                                        </a>
                                    </div>
                                </div>
                            </EditForm>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

